<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Zeichenfl√§che</title>
	<script type = "text/javascript" src = "teamZeichenflaeche/js/canvasHandler.js"> </script>
	<script type = "text/javascript" src = "admin/admin.js"></script>
	<script type = "text/javascript" src = "tool/tool.js"></script>
	<link rel="stylesheet" type="text/css" href="jsPaint.css">

</head>
<body>
	<div id="aContainer"></div>
	<div id="adminBox">
		<ul style="list-style:none" align="right">
			<li>
			<button onclick="dontUseTool();">NO Tool</button>
			</li>
						<li>
			<button onclick="useTool();">Tool</button>
			</li>
			
			<li>
			<button onclick="makeNew();">new</button>
			</li>
			
			<li>
				<button onclick="testDrawings();">draw test-picture</button>
			
			</li>
			
			<li>
				<button onclick="undoLast();" id="button_undo" disabled="1">undo</button>
			</li>
			
			<li>
				<button onclick="saveIt();">save</button>
			</li>
			
			<li>
				<button onclick="loadExternal();" id="button_load">load</button>
			</li>
			
			<li>
				<button onclick="deleteArt()">clear localStorage</button>
			</li>

			<br/>
		</ul>
	</div>
	<!-- simple test rectangle -->
	<div id="adminOutput"></div>
	<textarea id="textarea_as_store" cols="50" rows="4" readonly="1"></textarea>

	<script type="text/javascript">
		document.getElementById('adminOutput').innerHTML = listArt();

		var myHandler = new CanvasHandler();
		myHandler.appendNewCanvas('aContainer', 'myCanvas', 200, 200);

		//examples for the other teams
		function testDrawings() {
			var content = myHandler.getContext('2d');
			content.fillStyle = "rgba(0, 0, 200, 0.5)";
			content.fillRect (0, 0, 50, 50);
			
			//call this after each step (tool usage or else)
			myHandler.addHistorySnapshot();
			
			document.getElementById('button_undo').disabled = false;
			
			content.fillStyle = "rgba(0, 200, 0, 0.5)";
			content.fillRect (25, 25, 75, 75);
			
			myHandler.addHistorySnapshot();
			
			content.fillStyle = "rgba(200, 0, 0, 0.5)";
			content.fillRect (50, 50, 100, 100);
			myHandler.addHistorySnapshot();
		}
		
		function undoLast() {
			myHandler.revertToLastSnapshot();
			document.getElementById('button_undo').disabled = !myHandler.canUndo();
		}
		
		function makeNew() {
			myHandler.clearAll();
			document.getElementById('button_undo').disabled = !myHandler.canUndo();
		}

		//just an example
		function saveIt() {
			//simple json of the data (challenge: convert to 'png' or 'bmp')
			document.getElementById('textarea_as_store').innerHTML = myHandler.export();
			//document.getElementById('button_load').disabled = false;
			saveArt(myHandler.export());
			listArtInOutput();
		}

		//just an example
		function loadExternal(id) {
			if (id == null) {
				myHandler.import(loadArt(id));
				document.getElementById('button_undo').disabled = !myHandler.canUndo();
			} else {
				myHandler.import(localStorage.getItem(id));
			}
			document.getElementById('textarea_as_store').innerHTML = myHandler.export();
			myCanvas.removeEventListener('mousedown',function(event){tool.draw(event, content);});
			//myCanvas.removeEventListener('mousemove',function(event){tool.draw(event, content);},false);
		}

		function listArtInOutput () {
			document.getElementById('adminOutput').innerHTML = listArt();
		}

		function draw(event,canvasContext){
			var posX = event.clientX;
			var posY = event.clientY;
			var width = 10;
    		var color = '#008000';
			//console.log(canvasContext);
			//canvasContext.moveto(posX,posY);
			//canvasContext.lineto(posX,posY);

			canvasContext.fillstyle = color;
			canvasContext.beginPath();
			canvasContext.arc(posX,posY,width,0,Math.PI * 2,false);
			canvasContext.closePath();
			canvasContext.fill();
			//canvasContext.stroke(posX,posY);
		}

		//trying to get the tool to fill the canvas
		function useTool(){
			var tool = new Tool();
			var content = myHandler.getContext('2d');
			document.getElementById('aContainer').addEventListener('mousedown',function(){tool.draw(event, content);});
			//document.getElementById('aContainer').addEventListener('mousemove',function(){tool.draw(event, content);});
		}

		function dontUseTool(){
			document.getElementById('aContainer').removeEventListener('mousedown');
			//document.getElementById('aContainer').removeEventListener('mousemove');
			//myCanvas.addEventListener('mousemove',function(event){ draw(event, content);},true);
		}

	</script>

</body>
</html>
